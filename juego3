<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego 3 - Sopa de Letras</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #ffe6ee;
  text-align: center;
  padding: 20px;
}

.box {
  background: white;
  padding: 25px;
  border-radius: 12px;
  max-width: 800px;
  margin: auto;
}

.sopa {
  display: grid;
  grid-template-columns: repeat(15, 40px);
  gap: 5px;
  justify-content: center;
  margin: 25px auto;
}

.celda {
  width: 40px;
  height: 40px;
  border-radius: 6px;
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 18px;
  cursor: pointer;
  user-select: none;
}

.celda.seleccionada {
  background: #ffd6e7;
}

.celda.correcta {
  background: #ffb6c1;
  cursor: default;
}

ul {
  list-style: none;
  padding: 0;
}

li.encontrada {
  text-decoration: line-through;
  color: #c2185b;
}
#musica {
  position: fixed;
  width: 1px;
  height: 1px;
  overflow: hidden;
}

#volumen-control {
  position: fixed;
  bottom: 15px;
  right: 15px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 20px;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

#volumen {
  width: 80px;
}

#btnComprobar {
  margin-top: 20px;
  padding: 15px 35px;
  font-size: 20px;
  font-weight: bold;
  background: #ff6fa5;
  color: white;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  transition: 0.3s ease;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

#btnComprobar:hover {
  background: #ff4f91;
  transform: scale(1.05);
}

#btnComprobar:disabled {
  background: #d8a3b8;
  cursor: default;
  transform: none;
}

#overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(255, 182, 193, 0.65);
  backdrop-filter: blur(6px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  animation: fadeIn 0.6s ease forwards;
}

#popup {
  background: white;
  padding: 35px 30px;
  border-radius: 20px;
  max-width: 420px;
  width: 90%;
  text-align: center;
  box-shadow: 0 15px 40px rgba(0,0,0,0.25);
  animation: popIn 0.6s cubic-bezier(.34,1.56,.64,1);
}

#popup h2 {
  font-size: 40px;
  margin-bottom: 10px;
}

#popup p {
  font-size: 18px;
  line-height: 1.5;
  margin-bottom: 25px;
}

.botones-popup {
  display: flex;
  gap: 15px;
  justify-content: center;
}

.botones-popup button {
  padding: 12px 20px;
  font-size: 16px;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  background: #ff6fa5;
  color: white;
  font-weight: bold;
  transition: 0.3s ease;
}

.botones-popup button:hover {
  background: #ff4f91;
  transform: scale(1.08);
}

/* Animaciones */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes popIn {
  from { transform: scale(0.6); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

.corazon {
  position: fixed;
  top: -20px;
  font-size: 24px;
  animation: caer 4s linear forwards;
  pointer-events: none;
  z-index: 10000;
}

@keyframes caer {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(110vh) rotate(360deg);
    opacity: 0;
  }
}


</style>
</head>

<body>

<div class="box">
  <h1>ðŸ”Ž Sopa de Letras</h1>
  <p>EncontrÃ¡ las palabras escondidas ðŸ’–</p>

  <div class="sopa" id="sopa"></div>

  <h3>Palabras</h3>
  <ul id="lista"></ul>

  <p id="mensaje"></p>

  <button id="btnComprobar">ðŸ’— Comprobar</button>

  <div id="pregunta-final" style="display:none; margin-top:25px;">
    <h2>ðŸ’ž</h2>
    <p style="font-size:18px;">
      DespuÃ©s de cada juego, cada sonrisa y cada momento compartidoâ€¦<br><br>
      <strong>Â¿Te gustarÃ­a ser mi novia?</strong> ðŸ’–
    </p>

    <button onclick="respuestaSi()">ðŸ¥° SÃ­, obvio</button>
    <button onclick="respuestaSi()">ðŸ’– Claro que sÃ­</button>
  </div>

</div>

<script>
// =======================
// CONFIGURACIÃ“N
// =======================
const tamaÃ±o = 15;

const palabras = [
  "MONSTERHIGH",
  "AMOR",
  "HEARTOPIA",
  "AURORA",
  "HOWLEEN",
  "RAPUNZEL",
  "MARVEL",
  "EEVEE",
  "PIKMIN",
  "DANDY"
];

const letrasABC = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

// =======================
// CREAR GRILLA VACÃA
// =======================
const sopa = Array.from({ length: tamaÃ±o }, () =>
  Array(tamaÃ±o).fill("")
);

// =======================
// COLOCAR PALABRAS EN 8 DIRECCIONES
// =======================
function colocarPalabra(palabra) {

  const direcciones = [
    [0, 1],   // derecha
    [1, 0],   // abajo
    [0, -1],  // izquierda
    [-1, 0],  // arriba
    [1, 1],   // diagonal abajo derecha
    [1, -1],  // diagonal abajo izquierda
    [-1, 1],  // diagonal arriba derecha
    [-1, -1]  // diagonal arriba izquierda
  ];

  let colocada = false;

  for (let intento = 0; intento < 300 && !colocada; intento++) {

    const direccion =
      direcciones[Math.floor(Math.random() * direcciones.length)];

    const [df, dc] = direccion;

    const fila = Math.floor(Math.random() * tamaÃ±o);
    const col = Math.floor(Math.random() * tamaÃ±o);

    const filaFinal = fila + df * (palabra.length - 1);
    const colFinal = col + dc * (palabra.length - 1);

    // Verificar que entra en la grilla
    if (
      filaFinal < 0 || filaFinal >= tamaÃ±o ||
      colFinal < 0 || colFinal >= tamaÃ±o
    ) continue;

    let sePuede = true;

    for (let i = 0; i < palabra.length; i++) {
      const f = fila + df * i;
      const c = col + dc * i;

      if (
        sopa[f][c] !== "" &&
        sopa[f][c] !== palabra[i]
      ) {
        sePuede = false;
        break;
      }
    }

    if (sePuede) {
      for (let i = 0; i < palabra.length; i++) {
        const f = fila + df * i;
        const c = col + dc * i;
        sopa[f][c] = palabra[i];
      }
      colocada = true;
    }
  }

  if (!colocada) {
    console.log("No se pudo colocar:", palabra);
  }
}

// Colocar todas
palabras.forEach(colocarPalabra);

// =======================
// RELLENAR CON LETRAS ALEATORIAS
// =======================
for (let f = 0; f < tamaÃ±o; f++) {
  for (let c = 0; c < tamaÃ±o; c++) {
    if (sopa[f][c] === "") {
      sopa[f][c] =
        letrasABC[Math.floor(Math.random() * letrasABC.length)];
    }
  }
}

// =======================
// RENDERIZAR
// =======================
const sopaDiv = document.getElementById("sopa");
const lista = document.getElementById("lista");

palabras.forEach(p => {
  const li = document.createElement("li");
  li.textContent = p;
  li.id = "palabra-" + p;
  lista.appendChild(li);
});

sopa.forEach((fila, f) => {
  fila.forEach((letra, c) => {
    const div = document.createElement("div");
    div.className = "celda";
    div.textContent = letra;
    div.dataset.pos = `${f}-${c}`;

    sopaDiv.appendChild(div);
  });
});

// =======================
// SELECCIÃ“N
// =======================
let seleccion = [];
let palabrasEncontradas = [];
let inicio = null;
let direccion = null;
let seleccionando = false;

function getCelda(f, c) {
  return document.querySelector(
    `.celda[data-pos="${f}-${c}"]`
  );
}

// Detectar direcciÃ³n (dx, dy)
function calcularDireccion(origen, destino) {
  const [f1, c1] = origen;
  const [f2, c2] = destino;

  const df = f2 - f1;
  const dc = c2 - c1;

  return [
    Math.sign(df),
    Math.sign(dc)
  ];
}

// Mousedown: iniciar selecciÃ³n
document.querySelectorAll(".celda").forEach(celda => {

  celda.addEventListener("mousedown", e => {

    limpiarSeleccion();

    seleccionando = true;
    inicio = celda.dataset.pos.split("-").map(Number);
    seleccion = [celda];
    celda.classList.add("seleccionada");
  });

  // Mouseover: extender selecciÃ³n
  celda.addEventListener("mouseover", e => {
    if (!seleccionando) return;

    const actual = celda.dataset.pos.split("-").map(Number);

    if (!direccion) {
        direccion = calcularDireccion(inicio, actual);

        // âŒ si no hay movimiento real, no hacemos nada
        if (direccion[0] === 0 && direccion[1] === 0) {
            direccion = null;
            return;
        }
        }

    const [df, dc] = direccion;
    const ultimo = seleccion[seleccion.length - 1]
      .dataset.pos.split("-").map(Number);

    const esperado = [
      ultimo[0] + df,
      ultimo[1] + dc
    ];

    if (
      actual[0] === esperado[0] &&
      actual[1] === esperado[1]
    ) {
      if (!celda.classList.contains("seleccionada")) {
        seleccion.push(celda);
        celda.classList.add("seleccionada");
      }
    }
  });
});

// Mouseup: comprobar palabra
document.addEventListener("mouseup", () => {
  if (!seleccionando) return;

  seleccionando = false;

  const palabraFormada = seleccion
    .map(c => c.textContent)
    .join("");

  if (
    palabras.includes(palabraFormada) &&
    !palabrasEncontradas.includes(palabraFormada)
  ) {
    seleccion.forEach(c => {
      c.classList.remove("seleccionada");
      c.classList.add("correcta");
    });

    document
      .getElementById("palabra-" + palabraFormada)
      .classList.add("encontrada");

    palabrasEncontradas.push(palabraFormada);
  } else {
    limpiarSeleccion();
  }

  direccion = null;
  seleccion = [];
});

function limpiarSeleccion() {
  document
    .querySelectorAll(".celda.seleccionada")
    .forEach(c => c.classList.remove("seleccionada"));

  seleccion = [];
}

</script>
<!-- Reproductor oculto -->
<div id="musica">
  <div id="player"></div>
</div>

<!-- Control de volumen -->
<div id="volumen-control">
  ðŸ”Š
  <input type="range" min="0" max="100" value="50" id="volumen">
</div>


<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;
let musicaIniciada = false;

function onYouTubeIframeAPIReady() {
  player = new YT.Player("player", {
    videoId: "A105swihg80",
    playerVars: {
      controls: 0,
      modestbranding: 1,
      loop: 1,
      playlist: "A105swihg80"
    }
  });
}

// â–¶ï¸ PRIMER CLICK EN LA PÃGINA
document.addEventListener("click", () => {
  if (!player || musicaIniciada) return;

  player.setVolume(50);
  player.unMute();
  player.playVideo();

  musicaIniciada = true;
}, { once: true });

// ðŸŽšï¸ Control de volumen
document.getElementById("volumen").addEventListener("input", e => {
  if (!player) return;

  const v = e.target.value;
  player.setVolume(v);

  if (v == 0) {
    player.mute();
  } else {
    player.unMute();
  }
});

document.getElementById("btnComprobar").addEventListener("click", () => {

  if (palabrasEncontradas.length === palabras.length) {
    document.getElementById("mensaje").textContent =
      "âœ¨ Encontraste todas las palabras âœ¨";

    document.getElementById("overlay").style.display = "flex";
    document.getElementById("btnComprobar").disabled = true;

  } else {
    document.getElementById("mensaje").textContent =
      "ðŸ’­ AÃºn faltan algunas palabras por encontrarâ€¦";
  }

});

function respuestaSi() {
  const popup = document.getElementById("popup");

  popup.innerHTML = `
    <h2>ðŸ’–âœ¨</h2>
    <p style="font-size:20px;">
      SabÃ­a que ibas a decir que sÃ­â€¦<br><br>
      Gracias por elegirme ðŸ’•<br>
      Prometo cuidarte y hacerte sonreÃ­r siempre.
    </p>
  `;

  lanzarCorazones();
}

let lluviaActiva = false;
let intervaloCorazones;

function lanzarCorazones() {
  if (lluviaActiva) return;
  lluviaActiva = true;

  intervaloCorazones = setInterval(() => {

    // cantidad de corazones por tanda
    const cantidad = 4;

    for (let i = 0; i < cantidad; i++) {

      const corazon = document.createElement("div");
      corazon.classList.add("corazon");

      // distintos corazones para mÃ¡s efecto
      const corazones = ["ðŸ’–","ðŸ’—","ðŸ’˜","ðŸ’","ðŸ’ž"];
      corazon.textContent =
        corazones[Math.floor(Math.random() * corazones.length)];

      corazon.style.left = Math.random() * 100 + "vw";
      corazon.style.animationDuration = (3 + Math.random() * 2) + "s";
      corazon.style.fontSize = (18 + Math.random() * 22) + "px";

      document.body.appendChild(corazon);

      setTimeout(() => {
        corazon.remove();
      }, 6000);
    }

  }, 250); // cada 250ms
}

</script>
<div id="overlay" style="display:none;">
  <div id="popup">
    <h2>ðŸ’ž</h2>
    <p>
      DespuÃ©s de cada juego, cada sonrisa y cada momento compartidoâ€¦<br><br>
      <strong>Â¿Te gustarÃ­a ser mi novia?</strong> ðŸ’–
    </p>

    <div class="botones-popup">
      <button onclick="respuestaSi()">ðŸ¥° SÃ­, obvio</button>
      <button onclick="respuestaSi()">ðŸ’– Claro que sÃ­</button>
    </div>
  </div>
</div>

</body>
</html>
